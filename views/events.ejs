<%- include('partials/header', { title: 'Events • Local Community Portal', active: 'events' }) %>

<section class="container page-content">
  <h1>Events</h1>

  <!-- Filters -->
  <div class="filters">
    <div class="filters-row">
      <label>
        Year
        <select id="ev-year">
          <option value="">All</option>
          <% (years || []).forEach(y => { %>
            <option value="<%= y %>"><%= y %></option>
          <% }) %>
        </select>
      </label>

      <label>
        Area
        <select id="ev-area">
          <option value="">All</option>
          <% (areas || []).forEach(a => { %>
            <option value="<%= a.id %>"><%= a.name %></option>
          <% }) %>
        </select>
      </label>

      <label class="checkbox">
        <input id="ev-past" type="checkbox">
        Show past events
      </label>

      <label class="grow">
        Search events
        <input id="ev-q" type="search" placeholder="Search…">
      </label>

      <div class="pager">
        <button id="ev-prev" type="button">Previous</button>
        <button id="ev-next" type="button">Next</button>
      </div>
    </div>
  </div>

  <!-- Initial results rendered by the server -->
  <div id="events-results" class="events-grid" aria-live="polite">
    <% (items || []).forEach(ev => { 
         const img  = ev.image_url || ('/images/areas/' + String((ev.area||'sports')).toLowerCase().replace(/[^a-z0-9]+/g,'-') + '.jpg');
         const date = new Date(ev.date).toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
         const badgeClass = ev.isPast ? 'badge-past' : 'badge-upcoming';
         const badgeText  = ev.isPast ? 'Past' : 'Upcoming';
    %>
      <a class="event-card" href="/events/<%= ev.id %>" style="--bg:url('<%= img %>')">
        <div class="event-card__body">
          <h3 class="event-card__title"><%= ev.title %></h3>
          <p class="event-card__meta"><%= date %> · <%= ev.area || '' %></p>
          <span class="badge <%= badgeClass %>"><%= badgeText %></span>
          <% if (ev.summary) { %>
            <p class="event-card__summary"><%= ev.summary %></p>
          <% } %>
        </div>
      </a>
    <% }) %>
  </div>
</section>

<script src="/js/events.js" defer></script>
<%- include('partials/footer') %>