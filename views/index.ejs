<%- include('partials/header', { title: 'Local Community Portal', active: 'home' }) %>

<!-- INTRO: centered welcome -->
<section class="intro-panel">
  <div class="container intro-inner one-col">
    <div class="intro-copy">
      <h1>Welcome to your Local Community</h1>
      <p class="lead">
        Find local events, clubs, and services across Sports, Health, Education, and Arts.
        Explore what’s on this week and get involved.
      </p>
      <a href="/events" class="btn btn-primary">See all events</a>
    </div>
  </div>
</section>

<!-- EVENTS: featured card + small upcoming cards -->
<section class="container intro-events-block">
  <% if (featured) { %>
    <article class="card highlight" style="margin-bottom:12px;">
      <h3 class="eyebrow">Live / Next up</h3>
      <h2 class="card-title">
        <a href="/events/<%= featured.id %>"><%= featured.title %></a>
      </h2>
      <p class="meta">
        <strong>When:</strong>
        <time datetime="<%= featured.date %>">
          <%= new Date(featured.date).toLocaleDateString('en-GB', { weekday:'long', day:'numeric', month:'long', year:'numeric' }) %>
        </time>
        <% if (featured.area) { %> • <strong>Area:</strong> <%= featured.area %><% } %>
      </p>
      <% if (featured.summary) { %><p><%= featured.summary %></p><% } %>
    </article>
  <% } %>

  <div class="upcoming-mini">
    <% (upcoming || []).forEach(ev => { %>
      <article class="card mini">
        <h4><a href="/events/<%= ev.id %>"><%= ev.title %></a></h4>
        <p class="meta">
          <strong>Date:</strong>
          <time datetime="<%= ev.date %>">
            <%= new Date(ev.date).toLocaleDateString('en-GB', { day:'numeric', month:'long', year:'numeric' }) %>
          </time>
          <% if (ev.area) { %> • <%= ev.area %><% } %>
        </p>
        <% if (ev.summary) { %><p><%= ev.summary %></p><% } %>
      </article>
    <% }) %>
  </div>
</section>

<!-- AREAS: card panel wrapper + tidy 2×2 grid (Sports+Health on top) -->
<section class="areas-panel">
  <div class="container">
    <div class="card areas-panel-inner">
      <h2>Explore Community Areas</h2>
      <p class="muted">Browse activities and services by category.</p>

      <%
        // Build a lookup by lowercased name
        const byName = new Map((areas || []).map(a => [String(a.name||'').toLowerCase(), a]));

        // Find Arts even if named slightly differently
        function findArts(){
          return byName.get('arts & culture')
              || byName.get('arts and culture')
              || byName.get('arts')
              || null;
        }

        const sports    = byName.get('sports')    || null;
        const health    = byName.get('health')    || null;
        const education = byName.get('education') || null;
        const arts      = findArts();

        // Desired order
        const ordered = [sports, health, arts, education].filter(Boolean);

        // Slug helper (normalises Arts & Culture)
        function areaSlug(name){
          return /arts/i.test(name) && /culture|&/i.test(name)
            ? 'arts-and-culture'
            : String(name).toLowerCase();
        }
      %>

      <div class="areas-wrap">
        <div class="areas-grid-2x2">
          <% ordered.forEach(a => { %>
            <a href="/areas/<%= areaSlug(a.name) %>" class="card area-card">
              <h3><%= a.name %></h3>
              <p>See listings and events in <%= a.name %>.</p>
            </a>
          <% }) %>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('partials/footer') %>
